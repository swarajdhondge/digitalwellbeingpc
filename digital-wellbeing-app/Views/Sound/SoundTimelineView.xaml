<UserControl
    x:Class="digital_wellbeing_app.Views.Sound.SoundTimelineView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="clr-namespace:digital_wellbeing_app.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignHeight="450"
    d:DesignWidth="800"
    Loaded="OnLoaded"
    Background="{DynamicResource MaterialDesignPaper}">

    <UserControl.DataContext>
        <vm:SoundTimelineViewModel/>
    </UserControl.DataContext>

    <Grid>
        <StackPanel Margin="20">

            <!-- Header -->
            <TextBlock
                Text="🔈 Detailed Sound Output"
                FontSize="22"
                FontWeight="Bold"
                Foreground="{DynamicResource MaterialDesignBody}"
                Margin="0,0,0,8"/>

            <!-- Totals Card -->
            <Border
                Padding="16"
                Background="{DynamicResource MaterialDesignCardBackground}"
                Margin="0,8,0,16"
                Effect="{DynamicResource MaterialDesignElevation2}">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch">
                    <StackPanel Margin="0,0,20,0">
                        <TextBlock Text="Total Listening" FontSize="14" Foreground="{DynamicResource MaterialDesignBody}"/>
                        <TextBlock
                            Text="{Binding TotalListeningTime}"
                            FontSize="16"
                            FontWeight="Bold"
                            Foreground="{DynamicResource MaterialDesignGreen}"/>
                    </StackPanel>
                    <StackPanel>
                        <TextBlock Text="Total Harmful" FontSize="14" Foreground="{DynamicResource MaterialDesignBody}"/>
                        <TextBlock
                            Text="{Binding TotalHarmfulTime}"
                            FontSize="16"
                            FontWeight="Bold"
                            Foreground="{DynamicResource MaterialDesignRed}"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Timeline Canvas (white background + bars) -->
            <Border
                Padding="4"
                Background="{DynamicResource MaterialDesignCardBackground}"
                Margin="0,0,0,16"
                Effect="{DynamicResource MaterialDesignElevation1}">
                <Canvas
                    x:Name="FullTimelineCanvas"
                    Height="80"
                    Background="Transparent"/>
            </Border>

            <!-- Toggle Details Button -->
            <Button
                x:Name="ToggleDetailsButton"
                Content="Show detailed tracking"
                Width="180"
                Height="32"
                Click="ToggleDetailsButton_Click"
                HorizontalAlignment="Left"
                Margin="0,0,0,8"
                Style="{StaticResource MaterialDesignOutlinedButton}"/>

            <!-- Detailed DataGrid (initially visible=false) -->
            <DataGrid
                x:Name="DetailsDataGrid"
                ItemsSource="{Binding Sessions}"
                AutoGenerateColumns="False"
                IsReadOnly="True"
                HeadersVisibility="Column"
                CanUserResizeColumns="False"
                CanUserSortColumns="False"
                GridLinesVisibility="None"
                Height="200"
                Background="{DynamicResource MaterialDesignPaper}">
                <DataGrid.Columns>
                    <DataGridTextColumn
                        Header="Time"
                        Binding="{Binding SessionLabel}"
                        Width="2*"/>
                    <DataGridTextColumn
                        Header="Device"
                        Binding="{Binding DeviceName}"
                        Width="*"/>
                </DataGrid.Columns>
            </DataGrid>

        </StackPanel>
    </Grid>
</UserControl>
