<UserControl x:Class="digital_wellbeing_app.Views.Sound.SoundTimelineView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:digital_wellbeing_app.ViewModels"
             Loaded="OnLoaded"
             Height="Auto" Width="Auto">
    <UserControl.DataContext>
        <vm:SoundTimelineViewModel />
    </UserControl.DataContext>

    <!-- 
         Grid Layout:
         Row 0 = Summary (total listening / harmful)
         Row 1 = 24h markers + timeline bar
         Row 2 = Toggle Button
         Row 3 = Scrollable DataGrid (hidden until toggled)
    -->
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Row 0: Summary -->
            <RowDefinition Height="Auto"/>
            <!-- Row 1: Markers + timeline -->
            <RowDefinition Height="Auto"/>
            <!-- Row 2: Toggle button -->
            <RowDefinition Height="*"/>
            <!-- Row 3: Scrollable DataGrid -->
        </Grid.RowDefinitions>

        <!-- Row 0: Total listening / Total harmful -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
            <TextBlock FontSize="14" FontWeight="Bold"
                       Text="{Binding TotalListeningTime,
                                       StringFormat=Total listening: {0:h\\h\\ mm\\m\\ ss\\s}}"
                       Margin="0,0,20,0"/>
            <TextBlock FontSize="14" FontWeight="Bold"
                       Text="{Binding TotalHarmfulTime,
                                       StringFormat=Total harmful:   {0:h\\h\\ mm\\m\\ ss\\s}}"
                       Margin="0,0,20,0"/>
        </StackPanel>

        <!-- Row 1: 24-hour markers + Timeline bar -->
        <StackPanel Grid.Row="1">
            <!-- 24-hour markers -->
            <Grid Margin="0,0,0,5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="12 AM" HorizontalAlignment="Left" FontSize="12"/>
                <TextBlock Grid.Column="1" Text="3 AM"  HorizontalAlignment="Left" FontSize="12"/>
                <TextBlock Grid.Column="2" Text="6 AM"  HorizontalAlignment="Left" FontSize="12"/>
                <TextBlock Grid.Column="3" Text="9 AM"  HorizontalAlignment="Left" FontSize="12"/>
                <TextBlock Grid.Column="4" Text="12 PM" HorizontalAlignment="Left" FontSize="12"/>
                <TextBlock Grid.Column="5" Text="3 PM"  HorizontalAlignment="Left" FontSize="12"/>
                <TextBlock Grid.Column="6" Text="6 PM"  HorizontalAlignment="Left" FontSize="12"/>
                <TextBlock Grid.Column="7" Text="9 PM"  HorizontalAlignment="Left" FontSize="12"/>
            </Grid>

            <!-- Timeline Canvas -->
            <Border BorderBrush="Gray" BorderThickness="1" Height="60">
                <Canvas x:Name="FullTimelineCanvas" Background="#F5F5F5"/>
            </Border>
        </StackPanel>

        <!-- Row 2: Toggle Button -->
        <Button Grid.Row="2"
                x:Name="ToggleDetailsButton"
                Content="Show detailed tracking"
                Margin="0,10,0,10"
                Width="180"
                HorizontalAlignment="Left"
                Click="ToggleDetailsButton_Click"/>

        <!-- Row 3: Scrollable area containing only the DataGrid (initially collapsed) -->
        <ScrollViewer Grid.Row="3"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <DataGrid x:Name="DetailsDataGrid"
                      ItemsSource="{Binding Sessions}"
                      AutoGenerateColumns="False"
                      CanUserResizeRows="False"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      Visibility="Collapsed"
                      Margin="0,0,0,10">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Start Time"
                                         Binding="{Binding StartTime, StringFormat={}{0:HH:mm}}"
                                         MinWidth="75"/>
                    <DataGridTextColumn Header="End Time"
                                         Binding="{Binding EndTime, StringFormat={}{0:HH:mm}}"
                                         MinWidth="75"/>
                    <DataGridTextColumn Header="Device"
                                         Binding="{Binding DeviceName}"
                                         MinWidth="150"/>
                    <DataGridTextColumn Header="Type"
                                         Binding="{Binding DeviceType}"
                                         MinWidth="80"/>
                    <DataGridTextColumn Header="Avg Vol"
                                         Binding="{Binding AvgVolume, StringFormat={}{0:P0}}"
                                         MinWidth="75"/>
                    <DataGridTextColumn Header="Max SPL"
                                         Binding="{Binding EstimatedMaxSPL, StringFormat={}{0:F0} dB}"
                                         MinWidth="75"/>
                    <DataGridTextColumn Header="Harmful Time"
                                         Binding="{Binding HarmfulDuration, StringFormat={}{0:h\\h\\ mm\\m\\ ss\\s}}"
                                         MinWidth="100"/>
                </DataGrid.Columns>
            </DataGrid>
        </ScrollViewer>
    </Grid>
</UserControl>
