<Window
    x:Class="digital_wellbeing_app.MainWindow.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="Digital Wellbeing"
    Height="650" Width="1000"
    MinHeight="500" MinWidth="800"
    WindowStartupLocation="CenterScreen"
    WindowStyle="None"
    AllowsTransparency="True"
    Background="Transparent"
    ResizeMode="CanResizeWithGrip"
    StateChanged="Window_StateChanged"
    Closing="Window_Closing">

    <!-- Main Window Container with Shadow -->
    <Border x:Name="WindowBorder"
            Background="{DynamicResource Bg.Primary}"
            CornerRadius="8"
            Margin="10">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.5" Color="Black"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <!-- Title Bar -->
                <RowDefinition Height="48"/>
                <!-- Content -->
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- ============================================ -->
            <!-- CUSTOM TITLE BAR -->
            <!-- ============================================ -->
            <Grid Grid.Row="0"
                  Background="{DynamicResource Bg.Primary}"
                  MouseLeftButtonDown="TitleBar_MouseLeftButtonDown"
                  MouseLeftButtonUp="TitleBar_MouseLeftButtonUp">

                <!-- Round top corners -->
                <Border CornerRadius="8,8,0,0" Background="{DynamicResource Bg.Primary}"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <!-- App Icon + Title -->
                        <ColumnDefinition Width="Auto"/>
                        <!-- Spacer -->
                        <ColumnDefinition Width="*"/>
                        <!-- Notification Area (future) -->
                        <ColumnDefinition Width="Auto"/>
                        <!-- Window Controls -->
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- App Icon + Title -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                        <Image Source="/Resources/Icons/digital-balance-icon-32.png"
                               Width="20" Height="20"
                               RenderOptions.BitmapScalingMode="HighQuality"/>
                        <TextBlock Text="Digital Wellbeing"
                                   Style="{StaticResource HeadingSmall}"
                                   Margin="10,0,0,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Notification Area (reserved for break reminders) -->
                    <StackPanel x:Name="NotificationArea"
                                Grid.Column="2"
                                Orientation="Horizontal"
                                Margin="0,0,16,0"
                                VerticalAlignment="Center">
                        <!-- Notifications will be added here -->
                    </StackPanel>

                    <!-- Window Controls -->
                    <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Top">
                        <!-- Minimize -->
                        <Button x:Name="MinimizeButton"
                                Style="{StaticResource ButtonIcon}"
                                Click="MinimizeButton_Click"
                                ToolTip="Minimize">
                            <md:PackIcon Kind="WindowMinimize" Width="16" Height="16"/>
                        </Button>
                        <!-- Maximize/Restore -->
                        <Button x:Name="MaximizeButton"
                                Style="{StaticResource ButtonIcon}"
                                Click="MaximizeButton_Click"
                                ToolTip="Maximize">
                            <md:PackIcon x:Name="MaximizeIcon" Kind="WindowMaximize" Width="16" Height="16"/>
                        </Button>
                        <!-- Close -->
                        <Button x:Name="CloseButton"
                                Style="{StaticResource ButtonIcon}"
                                Click="CloseButton_Click"
                                ToolTip="Close">
                            <md:PackIcon Kind="WindowClose" Width="16" Height="16"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>

            <!-- ============================================ -->
            <!-- MAIN CONTENT AREA -->
            <!-- ============================================ -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <!-- Sidebar -->
                    <ColumnDefinition Width="220"/>
                    <!-- Content -->
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- ============================================ -->
                <!-- SIDEBAR NAVIGATION -->
                <!-- ============================================ -->
                <Border Grid.Column="0"
                        Style="{StaticResource SidebarContainer}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Main Navigation -->
                        <StackPanel Grid.Row="0" Margin="0,8,0,0">
                            <TextBlock Text="OVERVIEW" Style="{StaticResource NavSectionHeader}"/>

                            <Button x:Name="NavDashboard"
                                    Style="{StaticResource NavItem}"
                                    Tag="Active"
                                    Click="Dashboard_Click">
                                <StackPanel Orientation="Horizontal">
                                    <md:PackIcon Kind="ViewDashboard" Width="20" Height="20" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Dashboard" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button x:Name="NavScreen"
                                    Style="{StaticResource NavItem}"
                                    Click="ScreenTime_Click">
                                <StackPanel Orientation="Horizontal">
                                    <md:PackIcon Kind="Monitor" Width="20" Height="20" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Screen Time" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button x:Name="NavSound"
                                    Style="{StaticResource NavItem}"
                                    Click="Sound_Click">
                                <StackPanel Orientation="Horizontal">
                                    <md:PackIcon Kind="VolumeHigh" Width="20" Height="20" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Sound Output" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button x:Name="NavApps"
                                    Style="{StaticResource NavItem}"
                                    Click="AppUsage_Click">
                                <StackPanel Orientation="Horizontal">
                                    <md:PackIcon Kind="Apps" Width="20" Height="20" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="App Usage" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!-- Bottom Navigation -->
                        <StackPanel Grid.Row="2" Margin="0,0,0,16">
                            <Border Style="{StaticResource NavDivider}"/>

                            <Button x:Name="NavSettings"
                                    Style="{StaticResource NavItem}"
                                    Click="Settings_Click">
                                <StackPanel Orientation="Horizontal">
                                    <md:PackIcon Kind="Cog" Width="20" Height="20" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Settings" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource NavItem}"
                                    Click="Exit_Click">
                                <StackPanel Orientation="Horizontal">
                                    <md:PackIcon Kind="ExitToApp" Width="20" Height="20" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Exit" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <!-- Version -->
                            <TextBlock Text="v1.1.0"
                                       Style="{StaticResource LabelMuted}"
                                       Margin="24,16,0,0"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- ============================================ -->
                <!-- MAIN CONTENT -->
                <!-- ============================================ -->
                <Border Grid.Column="1"
                        Background="{DynamicResource Bg.Secondary}"
                        CornerRadius="0,0,8,0">
                    <ContentControl x:Name="MainContent"
                                    Style="{StaticResource AnimatedContentControl}"
                                    Margin="24"/>
                </Border>
            </Grid>

            <!-- Resize Grip (bottom-right corner) -->
            <ResizeGrip x:Name="ResizeGrip"
                        Grid.Row="1"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Bottom"
                        Cursor="SizeNWSE"
                        Visibility="Visible"/>
        </Grid>
    </Border>
</Window>
